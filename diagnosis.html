<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monex è¨ºæ–·é é¢</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: white;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      color: #333;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #4f46e5;
      margin-bottom: 20px;
      font-size: 24px;
    }
    .test {
      background: #f3f4f6;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      border-left: 4px solid #9ca3af;
    }
    .test.pass {
      background: #d1fae5;
      border-left-color: #10b981;
    }
    .test.fail {
      background: #fee2e2;
      border-left-color: #ef4444;
    }
    .test strong {
      display: block;
      margin-bottom: 5px;
    }
    button {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      font-weight: bold;
    }
    button:active {
      background: #4338ca;
    }
    .info {
      background: #dbeafe;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 14px;
    }
    .code {
      background: #1f2937;
      color: #10b981;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 12px;
      overflow-x: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Monex ç³»çµ±è¨ºæ–·</h1>
    <p style="margin-bottom: 20px; color: #6b7280;">æ­£åœ¨æª¢æ¸¬ä½ çš„è¨­å‚™å’Œç€è¦½å™¨...</p>
    
    <div id="tests"></div>
    
    <button onclick="runTests()">ğŸ”„ é‡æ–°æª¢æ¸¬</button>
    <button onclick="clearAndGo()" style="background: #10b981;">ğŸ§¹ æ¸…é™¤è³‡æ–™ä¸¦å‰å¾€ä¸»é </button>
    
    <div class="info">
      <strong>ğŸ“± è¨­å‚™è³‡è¨Š</strong>
      <div class="code" id="deviceInfo"></div>
    </div>
  </div>

  <script>
    const tests = [];
    
    function addTest(name, pass, message) {
      tests.push({ name, pass, message });
    }
    
    function runTests() {
      tests.length = 0;
      const container = document.getElementById('tests');
      
      // æ¸¬è©¦ 1: JavaScript åŸºæœ¬åŠŸèƒ½
      try {
        const test = true;
        addTest('JavaScript åŸ·è¡Œ', true, 'JavaScript å¯ä»¥æ­£å¸¸é‹è¡Œ');
      } catch (e) {
        addTest('JavaScript åŸ·è¡Œ', false, 'éŒ¯èª¤: ' + e.message);
      }
      
      // æ¸¬è©¦ 2: LocalStorage
      try {
        localStorage.setItem('test', 'ok');
        const result = localStorage.getItem('test');
        localStorage.removeItem('test');
        addTest('LocalStorage', result === 'ok', result === 'ok' ? 'å¯ä»¥å„²å­˜è³‡æ–™' : 'ç„¡æ³•å„²å­˜è³‡æ–™');
      } catch (e) {
        addTest('LocalStorage', false, 'éŒ¯èª¤: ' + e.message);
      }
      
      // æ¸¬è©¦ 3: Fetch API
      try {
        addTest('Fetch API', typeof fetch === 'function', typeof fetch === 'function' ? 'æ”¯æ´ç¶²è·¯è«‹æ±‚' : 'ä¸æ”¯æ´ Fetch');
      } catch (e) {
        addTest('Fetch API', false, 'éŒ¯èª¤: ' + e.message);
      }
      
      // æ¸¬è©¦ 4: Service Worker
      addTest('Service Worker', 'serviceWorker' in navigator, 
        'serviceWorker' in navigator ? 'æ”¯æ´ PWA åŠŸèƒ½' : 'ä¸æ”¯æ´ Service Worker');
      
      // æ¸¬è©¦ 5: æª¢æŸ¥æ˜¯å¦æœ‰èˆŠçš„ Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
          const hasOldSW = registrations.length > 0;
          addTest('èˆŠç‰ˆ Service Worker', !hasOldSW, 
            hasOldSW ? `âš ï¸ ç™¼ç¾ ${registrations.length} å€‹èˆŠçš„ Service Workerï¼Œé€™å¯èƒ½å°è‡´ç™½å±ï¼` : 'æ²’æœ‰èˆŠç‰ˆå¿«å–');
          displayTests();
        });
      }
      
      // æ¸¬è©¦ 6: æª¢æŸ¥ Firebase è…³æœ¬
      setTimeout(() => {
        addTest('Firebase è…³æœ¬', typeof firebase !== 'undefined', 
          typeof firebase !== 'undefined' ? 'Firebase å·²è¼‰å…¥' : 'âš ï¸ Firebase è¼‰å…¥å¤±æ•—');
        displayTests();
      }, 2000);
      
      displayTests();
      
      // é¡¯ç¤ºè¨­å‚™è³‡è¨Š
      document.getElementById('deviceInfo').innerHTML = `
User Agent: ${navigator.userAgent}
<br>è¢å¹•: ${screen.width}x${screen.height}
<br>è¦–çª—: ${window.innerWidth}x${window.innerHeight}
<br>ç€è¦½å™¨: ${getBrowserName()}
<br>PWA æ¨¡å¼: ${window.matchMedia('(display-mode: standalone)').matches ? 'æ˜¯' : 'å¦'}
      `;
    }
    
    function displayTests() {
      const container = document.getElementById('tests');
      container.innerHTML = tests.map(test => `
        <div class="test ${test.pass ? 'pass' : 'fail'}">
          <strong>${test.pass ? 'âœ…' : 'âŒ'} ${test.name}</strong>
          ${test.message}
        </div>
      `).join('');
    }
    
    function getBrowserName() {
      const ua = navigator.userAgent;
      if (ua.includes('Chrome')) return 'Chrome';
      if (ua.includes('Safari')) return 'Safari';
      if (ua.includes('Firefox')) return 'Firefox';
      if (ua.includes('Edge')) return 'Edge';
      return 'æœªçŸ¥';
    }
    
    async function clearAndGo() {
      if (confirm('å°‡æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™ã€Service Worker å’Œå¿«å–ï¼Œç¢ºå®šç¹¼çºŒï¼Ÿ')) {
        try {
          // æ¸…é™¤ Storage
          localStorage.clear();
          sessionStorage.clear();
          
          // æ¸…é™¤ Service Worker
          if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (let registration of registrations) {
              await registration.unregister();
            }
          }
          
          // æ¸…é™¤ Cache
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
          }
          
          alert('âœ… æ¸…é™¤å®Œæˆï¼å³å°‡å‰å¾€ä¸»é ...');
          window.location.href = './index.html';
        } catch (e) {
          alert('âŒ æ¸…é™¤å¤±æ•—: ' + e.message);
        }
      }
    }
    
    // è‡ªå‹•åŸ·è¡Œ
    runTests();
  </script>
</body>
</html>
